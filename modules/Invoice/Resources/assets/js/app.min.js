function calculateTotalPrice(count){var total_price=$(`#quantity_${count}`).val()*$(`#unit_price_${count}`).val();$(`#total_${count}`).val(total_price),getPurchaseTotalPrice()}function getPurchaseTotalPrice(){var total=0;$("#grandTotal").val(0),$('input[name^="total"]').each((function(){var value=parseFloat($(this).val());isNaN(value)||(total+=value)})),$("#grandTotal").val(total)}function getProduct(count){var product_id=$(`#product_id_${count}`).val(),product=products.find((product=>product.id==product_id));$(`#category_${count}`).val(product.category.name),$(`#unit_${count}`).val(product.unit.name),$(`#stock_${count}`).val(product.quantity),0==product.quantity||product.quantity<1||0==product.quantity?($(`#quantity_${count}`).attr("readonly","readonly"),$(`#unit_price_${count}`).attr("readonly","readonly")):($(`#quantity_${count}`).removeAttr("readonly","readonly"),$(`#unit_price_${count}`).removeAttr("readonly","readonly"))}function populateProductOptions(count,excludeProductIds){var option='<option value="">Select Product</option>';products.forEach((function(product){excludeProductIds.includes(product.id.toString())||(option+=`<option value="${product.id}">${product.name} -- ${product.category.name} (${product.unit.name})</option>`)})),$(`#product_id_${count}`).html(option)}document.addEventListener("DOMContentLoaded",(function(){$("#customer_id").select2({tags:!0}),$(".product_id").select2({tags:!0});var existingProductIds=[];$(document).on("click","#addRow",(function(){var count=parseInt($("#rowCount").val())+1,html="";$(".product_id").each((function(){var productId=$(this).val();productId&&existingProductIds.push(productId)})),html+="<tr>",html+=`<td><select name="product_id[]" class="form-control product_id" id="product_id_${count}" onchange="getProduct(${count})"></select></td>`,html+=`<td><input type="text" class="form-control form-number-input" id="category_${count}" readonly /></td>`,html+=`<td><input type="text" class="form-control form-number-input" id="unit_${count}" readonly /></td>`,html+=`<td><input type="number" class="form-control form-number-input" id="stock_${count}" readonly /></td>`,html+=`<td><input type="number" name="quantity[]" class="form-control form-number-input" id="quantity_${count}" onchange="calculateTotalPrice(${count})" onkeyup="calculateTotalPrice(${count})" value="0.00"></td>`,html+=`<td><input type="number" name="unit_price[]" class="form-control form-number-input" id="unit_price_${count}" onchange="calculateTotalPrice(${count})" onkeyup="calculateTotalPrice(${count})" value="0.00"></td>`,html+=`<td><input type="number" name="total[]" class="form-control" id="total_${count}" readonly value="0.00"></td>`,html+='<td><button type="button" class="btn btn-danger removeRow"><i class="fa fa-trash"></i></button></td>',html+="</tr>",$("#invoiceItem").append(html),populateProductOptions(count,existingProductIds),$("#rowCount").val(count),$(`#product_id_${count}`).select2({tags:!0})})),$(document).on("click",".removeRow",(function(){if($("#invoiceItem tr").length>1){var removedProductId=$(this).closest("tr").find(".product_id").val();existingProductIds=existingProductIds.filter((id=>id!==removedProductId)),$(this).closest("tr").remove()}else toastr.error("You cannot remove the last row!")}))}));